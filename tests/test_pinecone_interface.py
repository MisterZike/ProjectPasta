import unittest
from src.data.pinecone_interface import PineconeInterface


class TestPineconeInterface(unittest.TestCase):
    def setUp(self):
        self.interface = PineconeInterface()

    def test_a_get_index_list(self):
        print("AUTH TEST")
        index_list = self.interface.get_index_list()
        print("Index list:", index_list)
        self.assertIsInstance(index_list, list)

    def test_b_create_index(self):
        print("INDEX CREATION TEST")
        index_list = self.interface.get_index_list()
        if 'test-index' in index_list:
            self.interface.delete_index('test-index')

        # Index name must consist of lower case alphanumeric characters or '-'
        self.interface.create_index(index_name='test-index', dimension=8, metric='euclidean')

    def test_c_upsert_to_index(self):
        print("UPSERT TEST")
        data = [("A", [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]),
                ("B", [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]),
                ("C", [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3]),
                ("D", [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4]),
                ("E", [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5])]

        self.interface.upsert_to_index(index_name='test-index', vector_data=data)

    def test_d_query_index(self):
        print("RETRIEVAL TEST")
        vec = [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3]
        matches = self.interface.query_index('test-index', vector=vec, top_k=3, include_values=True)
        print(matches)

    def test_e_delete_index(self):
        print("DELETION TEST")
        if 'test-index' in self.interface.get_index_list():
            self.interface.delete_index('test-index')

    def test_f_upsert_to_index(self):
        data = [{'id': 'vec1', 'values': [0.08137517422437668, 0.021228836849331856, 0.021503673866391182, -0.012532700784504414, 0.03690406680107117, 0.004486787132918835, -0.025130556896328926, 0.03562182933092117, -0.03479423373937607, 0.021057285368442535, 0.01691371574997902, -0.0402192622423172, -0.042247992008924484, 0.07502201199531555, 0.0007798419683240354, 0.039494141936302185, -0.008369109593331814, 0.007525268010795116, -0.045434173196554184, 0.010020130313932896, -0.02814800664782524, -0.015971561893820763, 0.03251582011580467, 0.03781399130821228, -0.009124730713665485, -0.011847217567265034, -0.023447848856449127, 0.08599831908941269, 0.0003178598126396537, -0.08542349934577942, 0.013682957738637924, -0.02589341811835766, 0.002197178080677986, -0.0022741281427443027, 6.389003992524067e-09, 0.006206422578543425, -0.029460007324814796, -0.012849109247326851, -0.08873390406370163, 0.06530287116765976, -0.061239082366228104, 0.0034306799061596394, -0.04243126139044762, -0.027255769819021225, 0.045267343521118164, -0.09129825979471207, 0.006366724614053965, 0.04447384551167488, -0.010058537125587463, 0.07165098935365677, -0.023160627111792564, -0.046970006078481674, -0.01679663360118866, 0.006455383263528347, 0.020971443504095078, -0.042317379266023636, -0.01042783074080944, 0.023565158247947693, 0.007164053153246641, 0.03114236891269684, 0.0028402404859662056, -0.027183787897229195, 0.03459665924310684, -0.003909665159881115, -0.07705330103635788, -0.01263672299683094, -0.04441072419285774, -0.030645620077848434, 0.007044787984341383, 0.04075948894023895, -0.037544481456279755, -0.010856823064386845, -0.03131774812936783, 0.0012251022271811962, -0.01991935633122921, 0.009378853254020214, -0.011897061951458454, 0.03564462438225746, -0.00917537696659565, 0.02049834094941616, -0.03828723356127739, 0.015805663540959358, 0.014565440826117992, 0.0037429353687912226, 0.009938613511621952, 0.02138810232281685, 0.002505989745259285, -0.006435717456042767, 0.027356041595339775, -0.019760994240641594, 0.020603904500603676, 0.035876911133527756, 0.030597791075706482, 0.04921591281890869, 0.0004682770522776991, 0.017318541184067726, 0.06976300477981567, -0.028802530840039253, 0.025239892303943634, -0.006070711184293032, -0.013067681342363358, 0.009901282377541065, 0.006882215850055218, -0.04542412981390953, -0.050306737422943115, 0.011765534058213234, -0.02322644740343094, 0.03091159090399742, -0.018575340509414673, 0.09181788563728333, -0.03506350517272949, -0.011594802141189575, -0.05337134376168251, -0.0071491096168756485, 0.006266118958592415, -0.03621092066168785, -0.006364582106471062, -0.027212653309106827, -0.03298436105251312, 0.04258502647280693, 0.06057989224791527, 0.036351632326841354, -0.04120573401451111, -0.004522365517914295, 0.056755430996418, 0.03619247302412987, -0.0655519887804985, 0.004552728030830622, 0.016030602157115936, -0.0196137186139822, -0.028512703254818916, -0.00018567097140476108, 0.010443499311804771, -0.01542297936975956, 0.007968177087605, 0.021083081141114235, 0.020420556887984276, -0.025455335155129433, 0.008890039287507534, -0.005049212835729122, -0.03687046095728874, 0.01173942070454359, 0.004846694879233837, 0.03829006478190422, 0.009214971214532852, -0.01856767013669014, 0.02176566980779171, 0.0970381423830986, 0.006686937529593706, 0.04723690077662468, -0.00961275678128004, -0.008440126664936543, -0.0076820338144898415, 0.020922519266605377, -0.02401820383965969, -0.010311095044016838, -0.0059523507952690125, -0.0011653918772935867, 0.0028356255497783422, 0.014730317518115044, -0.020491672679781914, 0.017885712906718254, -0.03310947120189667, -0.020806124433875084, -0.08146312832832336, -0.0011912538902834058, 0.000790421268902719, -0.007748838514089584, 0.028540384024381638, 0.013790059834718704, 0.027621451765298843, -0.007890494540333748, -0.030519168823957443, 0.03291008993983269, 0.028276048600673676, -0.011441496200859547, 0.022108741104602814, -0.05836603045463562, -0.03235548362135887, 0.029190437868237495, 0.07520456612110138, -0.08848174661397934, 0.03278300538659096, -0.057647138833999634, 0.01833473891019821, 0.037429824471473694, -0.061957620084285736, 0.03781497851014137, 0.02178235724568367, 0.0013691216008737683, 0.00013354750990401953, -0.05231168121099472, 0.056869667023420334, 0.017323050647974014, 0.040539082139730453, 0.0005822149687446654, 0.04557550698518753, -0.09461285173892975, 0.006190044339746237, -0.028012849390506744, 0.013994711451232433, 0.025634899735450745, 0.04403475672006607, -0.03489455208182335, 0.020115597173571587, 0.004131439607590437, -0.054477401077747345, -0.022769398987293243, -0.07131197303533554, 0.04422875866293907, -0.0035338187590241432, -0.04024787247180939, -0.050407424569129944, 0.0021291584707796574, -0.018197568133473396, -0.01177079975605011, 0.012595931068062782, -0.05486989766359329, 0.062102168798446655, 0.018271107226610184, -0.008278895169496536, 0.05794910341501236, 0.015855442732572556, 0.05993777886033058, 0.04564063623547554, -0.009115472435951233, 0.00834258645772934, -0.023952826857566833, 0.035833489149808884, 0.041112758219242096, -0.007074393797665834, 0.03506964072585106, -0.008372175507247448, 0.04466796666383743, 0.04241420328617096, 0.0132058784365654, 0.07077112793922424, -0.018792804330587387, -0.011330137960612774, 0.07812444120645523, -0.07375696301460266, 0.033997610211372375, 0.03275586664676666, 0.004571645054966211, -0.08480414748191833, 0.061937782913446426, 0.05449225753545761, -0.005680500529706478, 0.0008784672245383263, -0.012828641571104527, -0.018224935978651047, -0.010573933832347393, 0.0009318779339082539, 0.028424346819519997, -0.002033370779827237, -0.01026647724211216, -0.05249790474772453, 0.02239791303873062, 0.014311082661151886, 0.05019916966557503, -0.013087034225463867, -0.0060243126936256886, 0.00998004525899887, -0.0017266609938815236, 0.060485757887363434, -0.038512762635946274, 0.02194201573729515, -0.02498299442231655, 0.028881611302495003, -0.005460308399051428, 0.0008334084413945675, 0.02692125365138054, 0.02584584429860115, 0.0011875552590936422, -0.04407668113708496, -0.007998736575245857, -0.00482929265126586, -0.035589803010225296, 0.035573460161685944, -0.04866889864206314, -0.006941955536603928, 0.03874441981315613, -0.009839392267167568, -0.003739513922482729, 0.0048093535006046295, 0.03714493289589882, -0.020268861204385757, 0.013586688786745071, 5.4925250879023224e-05, 0.005242350045591593, -0.005320272874087095, -0.07109422981739044, -0.009251046925783157, -0.020447680726647377, -0.036030255258083344, -0.003967605531215668, -0.055699411779642105, 0.03212369233369827, 0.01980339176952839, -0.043472424149513245, 0.018455713987350464, 0.03927589952945709, -0.013364309445023537, 0.022986143827438354, -0.05409461632370949, -0.011199725791811943, -0.03558802232146263, 0.045700423419475555, -0.0020961062982678413, -0.014239172451198101, -0.008384994231164455, 0.016647621989250183, -0.0051644169725477695, -0.001399431494064629, 0.048481281846761703, -0.034335557371377945, -0.030667103826999664, -0.016387561336159706, 0.009247459471225739, 0.07400675863027573, -0.003584112972021103, 0.030455438420176506, -0.013415614143013954, 0.03280656412243843, -0.042988646775484085, 0.03185763955116272, -0.015198241919279099, 0.022741947323083878, 0.009513776749372482, -0.014146924950182438, -0.004731428809463978, -0.042316414415836334, 0.00640080263838172, 0.005263528320938349, 0.018596941605210304, -0.047598227858543396, -0.049955736845731735, -0.024789543822407722, 0.024243580177426338, -0.004331202711910009, -0.06829023361206055, -0.06113780289888382, -0.011854763142764568, -0.01984899304807186, -0.0032549004536122084, 0.03002658113837242, -0.004051486495882273, -0.01983330212533474, -0.039314400404691696, 0.03243899345397949, 0.04722211882472038, -0.001453814678825438, 0.01674986444413662, -0.010987463407218456, 0.018283750861883163, 0.0383322536945343, -0.035951439291238785, 0.0412491112947464, 0.009764826856553555, -0.006004818715155125, 0.013696067966520786, 0.03137470409274101, 0.012496914714574814, 0.02307174541056156, 0.011413286440074444, 0.030345043167471886, -0.020457716658711433, 0.038536522537469864, -0.00502106174826622, 0.001734938588924706, 0.09625965356826782, 0.010845653712749481, -0.026828667148947716, 0.03179838880896568, 0.025710664689540863, -0.04166435822844505, 0.03810577839612961, 0.019067691639065742, 0.0009534775745123625, 0.012864934280514717, 0.018249427899718285, 0.06909250468015671, 0.029324553906917572, 0.044395897537469864, -0.048166122287511826, -0.03452300280332565, -0.05603063479065895, -0.042726222425699234, 0.006989817135035992, 0.00817838218063116, 0.04111914709210396, 0.03804175928235054, -0.04042228311300278, -0.0006685899570584297, 0.0025368344504386187, -0.0166766494512558, -0.017197847366333008, 0.008536351844668388, 0.0017033660551533103, 0.07510204613208771, -0.020030809566378593, -0.03153533488512039, 0.07690748572349548, 0.01724310778081417, -0.0040704854764044285, 0.09473501890897751, -0.021010300144553185, -0.02372293919324875, -0.014377172105014324, -0.011219760403037071, 0.024369459599256516, -0.09505169093608856, -0.047481462359428406, 0.026204485446214676, 0.02452053129673004, -0.04178282991051674, -0.04431898519396782, -0.03537799417972565, -0.06532920151948929, -0.06020357832312584, -0.02387901209294796, 0.004773882683366537, 0.030898567289114, 0.05251374840736389, -0.04502636566758156, 0.08125967532396317, -0.03204207122325897, -0.001522785983979702, 0.012908773496747017, 0.015588240697979927, 0.0006060749874450266, -0.009099738672375679, -0.029215019196271896, -0.06529846787452698, -0.017054885625839233, 0.019343119114637375, 0.09482546895742416, -0.013639052398502827, 0.01812490075826645, 0.010018248111009598, 0.03142395243048668, 0.01257183775305748, -0.004901876673102379, -0.006299788597971201, -0.042761191725730896, -0.012285471893846989, 0.024459557607769966, 0.015945060178637505, -0.016726193949580193, -0.026445742696523666, -0.017588067799806595, -0.0318635068833828, 0.0889524444937706, 0.1022196114063263, 0.057858143001794815, 0.021836616098880768, -0.04501106217503548, 0.04787323251366615, -0.04676239937543869, -0.03299619257450104, -0.00885486789047718, 8.231780590506332e-09, 0.00021112937247380614, 0.033517368137836456, 0.07714685797691345, -0.038896344602108, -0.040159907191991806, -0.04826758801937103, 0.005389648023992777, -0.0001398371096001938, -0.0013738633133471012, -0.022622661665081978, -0.03552035987377167, 0.03415590152144432, 0.1077321320772171, 0.025842027738690376, 0.06634391844272614, -0.004377502948045731, -0.04508630558848381, 0.022848688066005707, -0.02369268611073494, -0.06180853769183159, -0.017852209508419037, -0.04576718434691429, 0.005217330530285835, 0.032615307718515396, -0.015918942168354988, -0.004083534702658653, -0.0022833708208054304, -0.03951983153820038, 0.031698569655418396, -0.026177655905485153, 0.032975293695926666, 0.03156018629670143, -0.005874411202967167, 0.0995396226644516, 0.02392752841114998, -0.03729749470949173, -0.03655371069908142, -0.00855887308716774, 0.0022096962202340364, -0.028136897832155228, 0.0070084454491734505, 0.02858944982290268, -0.04575737193226814, -0.013738513924181461, 0.05321298912167549, 0.03205782175064087, 0.04168938472867012, -0.03137201815843582, 0.02588702365756035, -0.004895083140581846, -0.036932408809661865, 0.001408703625202179, 0.024727558717131615, -0.0928487479686737, -0.10893547534942627, -0.0827002301812172, 0.020271841436624527, -0.030619483441114426, 0.040530864149332047, -0.03925541043281555, 0.04514186456799507, -0.013885201886296272, 0.03894806280732155, -0.00943473819643259, 0.015560884959995747, -0.002757085021585226, 0.03800763189792633, 0.01150878332555294, 0.004651366733014584, 0.0017787659307941794, -0.006610579323023558, 0.01702859438955784, 0.005412332247942686, 0.02056973986327648, 0.02897271327674389, 0.04115162789821625, 0.01732819899916649, 0.025547252967953682, 0.03301926702260971, -0.05593153461813927, -0.010946519672870636, 0.024795107543468475, -0.026084676384925842, -0.011030754074454308, 0.004626693204045296, -0.005419442895799875, 0.0635371133685112, -0.015384389087557793, 0.03366777300834656, -0.0016350059304386377, -0.05203339830040932, 0.009663057513535023, -0.047464556992053986, 8.260369610546547e-10, -0.010206307284533978, -0.03914666548371315, -0.053066059947013855, 0.07380099594593048, -0.00560374790802598, 0.03403033688664436, -0.0011100340634584427, -0.043883316218853, 0.0003191804571542889, -0.010203825309872627, -0.04568186029791832, 0.017974989488720894, 0.005364661104977131, 0.025209827348589897, 0.028022458776831627, -0.04331493005156517, 0.011914072558283806, 0.0017449166625738144, 0.04144376888871193, -0.049526698887348175, -0.036260973662137985, 0.015870414674282074, -0.0074342540465295315, 0.04483594372868538, 0.008363006636500359, 0.019669177010655403, -0.01904872991144657, -0.024234557524323463, 0.022690225392580032, 0.019798951223492622, -0.000925838656257838, 0.013123640790581703, 0.05598693713545799, 0.05516389012336731, 0.007448599208146334, 0.05534365028142929, -0.013164795935153961, -0.004876786842942238, -0.032980311661958694, -0.02140091359615326, -0.045173145830631256, 0.023743072524666786, 0.009491438046097755, -0.029318097978830338, -0.011448835954070091, -0.0056738038547337055, -0.0316852405667305, -0.03992433473467827, -0.0017424782272428274, -0.06064522638916969, 0.016745341941714287, -0.013754461891949177, 0.014808548614382744, 0.04628090560436249, 0.03620259463787079, -0.006559350527822971, 0.014962613582611084, -0.02804027684032917, 0.12839889526367188, -0.09328067302703857, -0.03619924560189247, 0.0207547377794981, -0.044022418558597565, 0.03944096714258194, -0.03206639736890793, 0.004949697759002447, -0.0405300073325634, 0.007457717787474394, 0.06199076399207115, -0.01698858104646206, -0.0474739745259285, 0.003484268207103014, -0.008582754991948605, -0.042007967829704285, 0.022057650610804558, 0.029310351237654686, -0.0066643827594816685, -0.026780106127262115, 0.04204874485731125, 0.01255804393440485, -0.07541108131408691, -0.007751304656267166, 0.01726284995675087, 0.043990325182676315, -0.07698903977870941, 0.06269548833370209, 0.009266596287488937, -0.049287304282188416, 0.024163026362657547, -0.020046086981892586, -0.05065680295228958, 0.009726494550704956, -0.050815433263778687, 0.04789299517869949, 0.037325698882341385, -0.07717512547969818, 0.031087633222341537, 0.021529577672481537, 0.02033720165491104, -0.02052089385688305, 0.05501696094870567, -0.039349719882011414, 0.006872654426842928, -0.044841207563877106, 0.03210685774683952, -0.04121438041329384, 0.017118506133556366, 0.013163222931325436, -0.04018509015440941, 0.02050262875854969, 0.003747562412172556, -0.0060248831287026405, 0.03273628279566765, 0.007570499554276466, 0.012724143452942371, -0.05800304561853409, -0.01871354877948761, -0.02625448815524578, -0.03180965408682823, 0.015454909764230251, 0.017637668177485466, -0.01878202334046364, 0.011799389496445656, 0.0029450689908117056, -0.017619354650378227, 0.0038350566755980253, -0.003167118178680539, 0.049104511737823486, 0.018531108275055885, 0.027932938188314438, 0.017300179228186607, 0.0016450873808935285, 6.472517188882421e-09, 0.004336386453360319, -0.02037886157631874, 0.04669558256864548, 0.0025430871173739433, -0.002588254166767001, -0.032784782350063324, 0.012990374118089676, 0.0017174347303807735, -0.060650747269392014, -0.08529099076986313, -0.0046321796253323555, 0.021192975342273712, -0.013512392528355122, 0.004374416545033455, 0.028908584266901016, 0.056986041367053986, -0.013977408409118652, 0.026297785341739655, -0.02623315341770649, -0.006875894498080015, -0.06876008957624435, 0.020337961614131927, -0.002494585467502475, -0.017560770735144615, 0.02382216788828373, -0.03566467761993408, 0.004352819174528122, -0.09976083785295486, 0.010790452361106873, -0.02834351919591427, 0.007076256442815065, 0.035614028573036194, 0.04338797181844711, -0.07575181871652603, 0.03962702676653862, 0.015209676697850227, -0.04829688370227814, 0.016285989433526993, 0.018631532788276672, 0.019326226785779, -0.06765937805175781, -0.035704825073480606, 0.008815601468086243, -0.020932838320732117, 0.03791206702589989, 0.04070790857076645, 0.025666650384664536, 0.0018420363776385784, 0.010031619109213352, -0.04116884618997574, 0.007396192755550146, -0.009644262492656708, 0.06205227971076965, 0.010562723502516747, -0.014573327265679836, 0.010802939534187317, 0.05937306210398674, -0.059826456010341644, 0.041373349726200104, -0.046062104403972626, -0.038536425679922104, 0.013086807914078236, -0.047303456813097, -0.051627494394779205, -0.029815420508384705, -0.13103310763835907, 0.047066062688827515, -1.375653671789468e-33, -0.010627378709614277, 0.0363193079829216, 0.017726600170135498, -0.006746245082467794, -0.05558282136917114, 0.0012873201631009579, -0.0034708380699157715, -0.03954433277249336, 0.019188756123185158, -0.09109379351139069, -0.03682593256235123], 'metadata': {'item': 'Coles RSPCA Approved Chicken Drumsticks Large Pack | approx 1.6kg', 'price': '$6.40'}}]
        self.interface.upsert_to_index(index_name='coles-data', vector_data=data)